//
//  MessageCenterViewController.swift
//  Office
//
//  Created by roger on 2017/3/29.
//  Copyright © 2017年 roger. All rights reserved.
//

import UIKit
import HandyJSON
import CoreFramework
import SwiftyJSON

class MessageCenterViewController: BaseViewController {
    let tableView = BaseTableView()
    override func viewDidLoad() {
        super.viewDidLoad()
        creatUI()
    }
    override func viewWillAppear(_ animated: Bool) {
        super.viewWillAppear(animated)
        getData1()
    }
}

extension MessageCenterViewController{
    func getData1() {
        self.showloading()
        guard let jsrydm = DataCenter.ryxqModel?.jsrydm else {
            ProgressHUD.toast(message: "未登录")
            self.hideloading()
            return
        }
        //金三
        let para1: [String: Any]
        para1 = paraMaker(data: ["tranId":"SCDS.HLWGZPT.WB.JSDBRWXXCX", "s":"<swryDm>25134330918</swryDm><Fenye><FenyeVO><dqys>1</dqys><myts>5</myts><zts></zts></FenyeVO></Fenye>"], sid: "D6666", extra: [:])
        Network.post(parameter: para1, success: { (json) in
            self.hideloading()
            self.getData2()
            
            self.tableView.reloadData()
            
        }) { (error) in
            self.hideloading()
            ProgressHUD.toast(message: error)
        }
        
    }
        
        func getData2(){
            //OA
            guard let jsrydm = DataCenter.ryxqModel?.jsrydm else {
                ProgressHUD.toast(message: "未登录")
                self.hideloading()
                return
            }
            let para2: [String: Any]
            para2 = paraMaker(data: ["tranId":"SCDS.HLWGZPT.WB.OADBRWXXCX", "s":"<swryDm>25134330918</swryDm><Fenye><FenyeVO><dqys>1</dqys><myts>5</myts><zts></zts></FenyeVO></Fenye>"], sid: "D6666", extra: [:])
            Network.post(parameter: para2, success: { (json) in
                self.hideloading()
                self.getData3()
                self.tableView.reloadData()
                
            }) { (error) in
                self.hideloading()
                ProgressHUD.toast(message: error)
            }

        }
        func getData3(){
            //运维
            guard let jsrydm = DataCenter.ryxqModel?.jsrydm else {
                ProgressHUD.toast(message: "未登录")
                self.hideloading()
                return
            }
            let para3: [String: Any]
            para3 = paraMaker(data: ["tranId":"SCDS.HLWGZPT.WB.YWDBRWXXCX", "s":"<swryDm>25134330918</swryDm><Fenye><FenyeVO><dqys>1</dqys><myts>5</myts><zts></zts></FenyeVO></Fenye>"], sid: "D6666", extra: [:])
            Network.post(parameter: para3, success: { (json) in
                self.hideloading()
                
                self.tableView.reloadData()
                
            }) { (error) in
                self.hideloading()
                ProgressHUD.toast(message: error)
            }
 
    }
    
    func creatUI() {
        
        let item = UIBarButtonItem(image: UIImage(named: "mo_ren_tou_xiang"), style: UIBarButtonItemStyle.plain, target: self, action: #selector(btnClicked))
        self.navigationItem.leftBarButtonItem = item
        
        title = "任务通知"
        view.addSubview(tableView)
        tableView.delegate = self
        tableView.dataSource = self
        tableView.snp.makeConstraints { (make) in
            make.top.left.bottom.right.equalToSuperview()
        }
    }
}

extension MessageCenterViewController: UITableViewDelegate,UITableViewDataSource{
    
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        return 4
    }
    
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let cell = Bundle.main.loadNibNamed("MessageCenterCell", owner: self, options: nil)?.last as! MessageCenterCell
        if indexPath.row == 0 {
            cell.title.text = "金三系统代办任务消息"
            cell.detail.text = "啦啦啦 啦啦啦 "
            cell.time.text = "刚刚"
            cell.photo.text = "金三"
            cell.weidu.layer.masksToBounds = true
            cell.weidu.layer.cornerRadius = 15/2
            cell.photo.backgroundColor = UIColor.C1
            
        }else if indexPath.row == 1{
            cell.title.text = "OA系统代办任务消息"
            cell.detail.text = "啦啦啦 啦啦啦 "
            cell.time.text = "15:10"
            cell.photo.text = "OA"
            cell.weidu.layer.masksToBounds = true
            cell.weidu.layer.cornerRadius = 15/2
            cell.photo.backgroundColor = UIColor.C2
        
        }else if indexPath.row == 2{
            cell.title.text = "运维系统代办任务消息"
            cell.detail.text = "哈哈哈 啦啦啦 "
            cell.time.text = "昨天"
            cell.photo.text = "运维"
            cell.weidu.layer.masksToBounds = true
            cell.weidu.layer.cornerRadius = 15/2
            cell.photo.backgroundColor = UIColor.C5
            
        }else if indexPath.row == 3{
            cell.title.text = "绩效系统代办任务消息"
            cell.detail.text = "哈哈哈 啦啦啦 "
            cell.time.text = "2015-06-11"
            cell.photo.text = "绩效"
            cell.weidu.layer.masksToBounds = true
            cell.weidu.layer.cornerRadius = 15/2
            cell.photo.backgroundColor = UIColor.C3
            
        }
        return cell
    }
    func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -> CGFloat {
        return 75
    }
    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        tableView.deselectRow(at: indexPath, animated: true)
        let vc = MessegeContentController()
        if indexPath.row == 0 {
            vc.title = "金三"
        }else if indexPath.row == 1{
            vc.title = "OA"
        }else if indexPath.row == 2{
            vc.title = "运维"
        }else if indexPath.row == 3{
            vc.title = "绩效"
        }
        self.navigationController?.pushViewController(vc, animated: true)
    }
}
extension MessageCenterViewController{
    func btnClicked(){
        let mineVC = MineViewController()
        mineVC.hidesBottomBarWhenPushed = true
        self.navigationController?.pushViewController(mineVC, animated: true)
    }
}
